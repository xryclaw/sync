# 服务管理脚本使用说明

本项目提供了一套完整的服务管理脚本，方便快速启动、停止和管理 SLS 日志分析平台。

## 📁 脚本列表

| 脚本 | 功能 | 使用场景 |
|------|------|----------|
| `start.ps1` | 启动服务 | 首次启动或停止后重新启动 |
| `stop.ps1` | 停止服务 | 关闭所有服务进程 |
| `restart.ps1` | 重启服务 | 修改代码后快速重启 |
| `status.ps1` | 查看状态 | 检查服务运行状态和资源占用 |

## 🚀 快速开始

### 1. 启动服务

```powershell
.\start.ps1
```

**功能：**
- 自动检查 Node.js 环境
- 自动安装缺失的依赖
- 启动后端服务（端口 3000）
- 启动前端服务（端口 5173）
- 后台运行，不阻塞终端

**输出示例：**
```
========================================
  SLS 日志分析平台 - 启动中...
========================================

🔍 检查环境...
   ✓ Node.js: v20.10.0

📦 检查依赖...
   ✓ 依赖检查完成

🚀 启动后端服务...
   ✓ 后端已启动 (PID: 12345)
   📍 API: http://localhost:3000

🚀 启动前端服务...
   ✓ 前端已启动 (PID: 12346)
   📍 Web: http://localhost:5173

========================================
  ✅ 服务启动成功！
========================================

📍 访问地址:
   前端: http://localhost:5173
   后端: http://localhost:3000
```

### 2. 停止服务

```powershell
.\stop.ps1
```

**功能：**
- 停止后端进程
- 停止前端进程
- 清理残留的 Vite 进程
- 删除 PID 记录文件

### 3. 重启服务

```powershell
.\restart.ps1
```

**功能：**
- 先停止所有服务
- 等待 2 秒
- 重新启动所有服务

**适用场景：**
- 修改了后端代码
- 修改了配置文件
- 服务出现异常需要重启

### 4. 查看状态

```powershell
.\status.ps1
```

**功能：**
- 显示进程运行状态
- 显示内存和 CPU 占用
- 检查端口监听状态
- 显示访问地址

**输出示例：**
```
========================================
  SLS 日志分析平台 - 状态检查
========================================

📊 进程状态:

   ✅ 后端: 运行中
      PID: 12345
      内存: 45.23 MB
      CPU: 2.5s

   ✅ 前端: 运行中
      PID: 12346
      内存: 120.45 MB
      CPU: 5.2s

========================================

🌐 端口检查:

   ✅ 后端端口 3000: 监听中
   ✅ 前端端口 5173: 监听中

========================================

📍 访问地址:
   前端: http://localhost:5173
   后端: http://localhost:3000
```

## 🔧 技术细节

### 进程管理

- 使用 PowerShell 的 `Start-Process` 启动后台进程
- 进程 PID 保存在 `.pids` 文件中
- 停止时通过 PID 精确终止进程

### 依赖检查

- 启动前自动检查 `node_modules` 目录
- 如果依赖缺失，自动运行 `npm install`

### 端口配置

- 后端默认端口：`3000`
- 前端默认端口：`5173`（Vite 默认）

如需修改端口：
- 后端：修改 `backend/.env` 中的 `PORT`
- 前端：修改 `frontend/vite.config.js` 中的 `server.port`

## ⚠️ 注意事项

1. **首次运行**
   - 确保已安装 Node.js（建议 v18+）
   - 首次启动会自动安装依赖，需要一些时间

2. **端口占用**
   - 如果端口被占用，服务会启动失败
   - 使用 `netstat -ano | findstr "3000"` 查看端口占用
   - 使用 `taskkill /PID <PID> /F` 强制结束占用进程

3. **权限问题**
   - 如果遇到权限错误，以管理员身份运行 PowerShell
   - 或者修改 PowerShell 执行策略：`Set-ExecutionPolicy RemoteSigned`

4. **进程残留**
   - 如果 `stop.ps1` 无法停止服务
   - 手动查找进程：`Get-Process -Name node`
   - 强制停止：`Stop-Process -Name node -Force`

## 🐛 故障排查

### 问题：启动后无法访问

**检查步骤：**
1. 运行 `.\status.ps1` 查看服务状态
2. 检查防火墙是否阻止了端口
3. 查看后端日志：`backend/logs/`
4. 检查 `.env` 配置是否正确

### 问题：停止脚本无效

**解决方法：**
```powershell
# 查找所有 node 进程
Get-Process -Name node

# 强制停止所有 node 进程
Stop-Process -Name node -Force

# 删除 PID 文件
Remove-Item .pids -Force
```

### 问题：端口被占用

**解决方法：**
```powershell
# 查看端口占用
netstat -ano | findstr "3000"
netstat -ano | findstr "5173"

# 根据 PID 停止进程
taskkill /PID <PID> /F
```

## 📝 开发建议

### 开发模式

开发时建议直接使用 npm 命令，可以看到实时日志：

```powershell
# 终端 1 - 后端
cd backend
npm run dev

# 终端 2 - 前端
cd frontend
npm run dev
```

### 生产模式

生产环境使用脚本启动，后台运行：

```powershell
.\start.ps1
```

## 🔄 更新日志

- **2026-02-14**: 初始版本，支持启动、停止、重启、状态查看

---

**提示：** 如有问题或建议，请联系开发团队。
